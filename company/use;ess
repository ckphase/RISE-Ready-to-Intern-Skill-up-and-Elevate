<?php
session_start();

if (isset($_GET['id'])) {
    $_SESSION['company_id'] = intval($_GET['id']);
}

if (!isset($_SESSION['company_id'])) {
    header("Location: companyLogin.php");
    exit();
}

$company_id = $_SESSION['company_id'];

include("companyHeader.php");
include('../dbms/connection.php');

// Handle form submission
if ($_SERVER["REQUEST_METHOD"] == "POST") {
    $title = $_POST['title'];
    $description = $_POST['description'];
    $location = $_POST['location'];
    $duration = $_POST['duration'];
    $stipend = $_POST['stipend'];
    $last_date = $_POST['last_date'];

    if (!empty($title) && !empty($description)) {
        $stmt = $db->prepare("INSERT INTO internships (company_id, title, description, location, duration, stipend, last_date) VALUES (?, ?, ?, ?, ?, ?, ?)");
        $stmt->bind_param("issssss", $company_id, $title, $description, $location, $duration, $stipend, $last_date);
        if ($stmt->execute()) {
            $message = "<div class='alert alert-success'>Internship posted successfully!</div>";
        } else {
            $message = "<div class='alert alert-danger'>Error: Unable to post internship.</div>";
        }
        $stmt->close();
    } else {
        $message = "<div class='alert alert-warning'>Please fill all required fields.</div>";
    }
}

// Fetch posted internships
$internships = [];
$result = $db->query("SELECT id, title FROM internships WHERE company_id = $company_id ORDER BY created_at DESC");
if ($result && $result->num_rows > 0) {
    while ($row = $result->fetch_assoc()) {
        $internships[] = $row;
    }
}
?>

<div class="container-fluid text-white" style="background: rgba(136, 211, 238, 1); padding: 40px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">
    <div class="container">
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-center">
            <div>
                <h2 class="fw-bold mb-1 text-black" style="letter-spacing: 1px;">Post and Check Your Openings</h2>
                <h4 class="mb-0 text-light">RISE Profile Page</h4>
            </div>
        </div>
    </div>
</div>